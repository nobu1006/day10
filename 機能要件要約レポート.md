# 機能要件 要約レポート（テスト設計用）

本ドキュメントは「社内図書貸出システム」の機能要件を、テスト設計（テストケース作成）に必要な観点で整理・要約したものである。

---

## 1. 利用者管理 (2.1)

### 1.1 機能の目的
社内図書を利用する社員の情報を一元管理し、貸出・返却の主体を特定する。

### 1.2 入力データ
| パラメータ | データ型 | 制約・条件 |
| :--- | :--- | :--- |
| 社員番号 | 文字列/数値 | 一意に識別可能であること |
| 氏名 | 文字列 | 必須 |
| 所属部署 | 文字列 | 必須 / 一覧表示での絞り込み対象 |

### 1.3 処理フロー
1.  **登録**: 管理者が利用者情報を入力し、システムに保存する。
2.  **検索**: 利用者が社員番号または氏名を入力し、一致する利用者を抽出する。
3.  **一覧表示**: 登録されている全利用者をリスト表示する。必要に応じて所属部署でフィルタリングを行う。

### 1.4 出力データ
*   登録結果（成功/失敗メッセージ）
*   検索結果一覧（社員番号、氏名、所属部署）
*   フィルタリング後の利用者リスト

### 1.5 エラーハンドリング
*   **権限エラー**: 一般利用者が登録操作を行おうとした場合のアラート。
*   **バリデーション**: 必須項目漏れや重複した社員番号の登録防止。

### 1.6 前提条件・後置条件
*   **前提**: 管理者ロールでログインしていること（登録時）。
*   **後置**: 登録された利用者が「貸出処理」の対象として選択可能になること。

---

## 2. 図書管理 (2.2)

### 2.1 機能の目的
貸出対象となる図書・資料の情報を管理し、在庫状況を把握可能にする。

### 2.2 入力データ
| パラメータ | データ型 | 制約・条件 |
| :--- | :--- | :--- |
| 図書ID | 文字列/数値 | 一意に識別可能であること |
| タイトル | 文字列 | 必須 |
| 著者 | 文字列 | 必須 |
| ISBN | 文字列 | 任意 |
| カテゴリ | 文字列 | 必須 |
| 貸出可能数 | 数値 | 初期登録時に設定 |

### 2.3 処理フロー
1.  **登録**: 管理者が図書情報を入力し保存する。
2.  **検索**: タイトル・著者・カテゴリ・キーワードを条件に図書を抽出する。
3.  **一覧**: 全図書を表示し、「在庫あり/貸出中」でフィルタリングする。
4.  **削除**: 対象図書の貸出数が0であることを確認し、論理削除（無効化）する。履歴は保持する。

### 2.4 出力データ
*   図書詳細情報、検索結果リスト、在庫ステータス。

### 2.5 エラーハンドリング
*   **削除不可**: 貸出中の図書（貸出数が1以上）を削除しようとした場合のエラー通知。
*   **権限エラー**: 一般利用者による登録・削除操作の拒否。

### 2.6 前提条件・後置条件
*   **前提**: 削除時は「現在貸出中ではない」ことが必須条件。
*   **後置**: 削除された図書は一覧・検索に表示されなくなるが、管理ログには残る。

---

## 3. 貸出・返却 (2.3)

### 3.1 機能の目的
図書の貸出・返却プロセスを制御し、貸出状況と期限を正確に管理する。

### 3.2 入力データ
| 操作 | 入力パラメータ | 制約・条件 |
| :--- | :--- | :--- |
| 貸出 | 利用者ID、図書ID | 1人最大5冊まで |
| 返却 | 貸出ID または (利用者ID+図書ID) | システム日付を返却日とする |
| 延長 | 貸出ID | 期限内かつ1回のみ |

### 3.3 処理フロー
1.  **貸出**: 利用者と図書を紐付け、当日より14日後を期限として記録する。
2.  **返却**: 返却処理を行い、貸出ステータスを更新する。返却日（システム日付）を残す。
3.  **延長**: 返却期限日前に操作された場合、期限をさらに14日間延長する。

### 3.4 出力データ
*   貸出完了情報（期限日含む）、返却完了通知、更新後の貸出履歴。
*   **表示ルール**: 期限超過図書の強調表示（一覧画面）。

### 3.5 エラーハンドリング
*   **冊数制限**: 既に5冊貸出済みの利用者が新たに貸出を行おうとした場合のエラー。
*   **延長制限**: 期限を過ぎた図書、または既に1回延長済みの図書の延長拒否。

### 3.6 前提条件・後置条件
*   **前提**: 貸出時は利用者が「利用者マスタ」に、図書が「図書マスタ（在庫あり）」に存在すること。
*   **後置**: 返却後は当該図書の在庫が復元し、他の利用者が貸出可能になること。

---

## 4. 管理者機能・ログ (2.4)

### 4.1 機能の目的
権限分離によるセキュリティの確保と、操作履歴（オーディットトレイル）の保持。

### 4.2 入力データ
| パラメータ | 内容 |
| :--- | :--- |
| ロール | 管理者 / 一般 |
| 操作ログ項目 | 実行者、日時、操作内容（貸出・返却・登録・削除） |

### 4.3 処理フロー
1.  **認可**: ログインユーザーのロールに応じ、メニュー表示や実行可能機能を制限する。
2.  **ロギング**: 特定の操作（2.4節参照）が発生した際、自動的にログテーブルへ記録する。

### 4.4 出力データ
*   管理者：全貸出履歴、操作ログ一覧。
*   一般：自分の貸出・返却履歴のみ。

### 4.5 エラーハンドリング
*   未ログイン状態での機能アクセス遮断。
*   権限外リソースへの直接アクセス（URL直打ち等）の拒否。
